<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Agent Dashboard</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: #e0f7ff;
    color: #003366;
    margin: 0;
    user-select: none;
    font-size: 11px;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  h2 {
    text-align: center;
    color: #0077cc;
    margin: 5px 0;
    font-size: 18px;
  }

  #lastUpdated {
    text-align: center;
    font-size: 10px;
    color: #004d80;
    margin: 2px 0;
  }

  select {
    padding: 3px 6px;
    font-size: 11px;
    border-radius: 4px;
    border: 1px solid #00bfff;
    background: #b3e5ff;
    color: #003366;
    margin-bottom: 6px;
  }

  .top-row {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 12px;
  }

  .metric-box {
    flex: 0 0 32%;
    background: linear-gradient(135deg, #00bfff, #1ec5ff);
    border: 2px solid #00f0ff;
    padding: 12px;
    border-radius: 12px;
    text-align: center;
    font-weight: bold;
    color: #003366;
    box-shadow: 0 0 15px rgba(0, 240, 255, 0.9);
    position: relative;
    overflow: hidden;
    animation: pop 2s infinite alternate;
  }

  .metric-box:nth-child(2) {
    animation-delay: 0.3s;
  }

  .metric-box:nth-child(3) {
    animation-delay: 0.6s;
  }

  @keyframes pop {
    0% { transform: scale(1); box-shadow: 0 0 15px rgba(0, 240, 255, 0.7); }
    50% { transform: scale(1.1); box-shadow: 0 0 25px rgba(0, 240, 255, 1); }
    100% { transform: scale(1); box-shadow: 0 0 15px rgba(0, 240, 255, 0.7); }
  }

  .metric-box .title {
    font-size: 16px;
    font-weight: bold;
    text-shadow: 0 0 3px #00f0ff, 0 0 6px #00f0ff;
    margin-bottom: 6px;
    letter-spacing: 0.5px;
  }

  .metric-box .agent {
    font-size: 14px;
    margin: 3px 0;
    text-shadow: 0 0 2px #ffffff, 0 0 4px #00bfff;
  }

  .shift-container {
    display: flex;
    justify-content: space-between;
    gap: 6px;
    flex: 1 1 auto;
    overflow: hidden;
  }

  .shift-table {
    background: #b3e5ff;
    border-radius: 6px;
    padding: 6px;
    flex: 1;
    min-width: 45%;
    box-shadow: 0 0 8px #00bfff88;
    text-align: center;
    display: flex;
    flex-direction: column;
    height: 100%;
    color: #003366;
    overflow: hidden;
  }

  .shift-table h3 {
    margin: 3px 0 6px;
    font-size: 13px;
    color: #0077cc;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 11px;
    background: #e6f7ff;
    flex: 1 1 auto;
    color: #003366;
    overflow: hidden;
  }

  thead th {
    background: #00bfff;
    padding: 4px;
    font-size: 11px;
    color: #003366;
    cursor: pointer;
    border-radius: 4px;
  }

  tbody td {
    padding: 3px 2px;
    text-align: center;
    border-bottom: 1px solid #00aaff;
  }

  tbody tr:nth-child(odd) {
    background-color: #cceeff;
  }

  tbody tr:last-child {
    background-color: #00bfff;
    font-weight: bold;
    color: #ffffff;
  }

  tbody tr:hover {
    background-color: #99e6ff;
  }

  #passwordInput {
    font-size: 16px;
    padding: 8px;
    margin: 10px 0;
  }

  .show-password-btn {
    color: #0077cc;
    cursor: pointer;
    text-decoration: underline;
  }

</style>
</head>
<body>
<h2>Agent Dashboard - Compact View</h2>
<div id="lastUpdated"></div>
<div style="text-align:center;">
  <select id="monthDropdown"></select>
</div>

<div class="top-row">
  <div id="topSok" class="metric-box"></div>
  <div id="topProfit" class="metric-box"></div>
  <div id="topCalls" class="metric-box"></div>
</div>

<div class="shift-container">
  <div class="shift-table">
    <h3>Morning Shift</h3>
    <div id="morningTable" style="flex:1 1 auto; overflow:auto;"></div>
  </div>
  <div class="shift-table">
    <h3>Night Shift</h3>
    <div id="nightTable" style="flex:1 1 auto; overflow:auto;"></div>
  </div>
</div>

<div id="passwordPrompt" style="display: block;">
  <div style="text-align: center;">
    <h3>Enter Password</h3>
    <input id="passwordInput" type="password" placeholder="Enter password" />
    <span class="show-password-btn" onclick="togglePassword()">Show</span>
    <br />
    <button onclick="checkPassword()">Submit</button>
  </div>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRyYD7X2tEKE1YJZU8pEF1KNtW43dMh0Kg-kRr1NV7u5mJZnSBZq_7p6OBCb3X322z10ReriXHngSRq/pub?gid=1105455398&single=true&output=csv";

const validPassword = "blauda123"; // Set your password here
const monthDropdown = document.getElementById('monthDropdown');
const topSok = document.getElementById('topSok');
const topProfit = document.getElementById('topProfit');
const topCalls = document.getElementById('topCalls');
const morningDiv = document.getElementById('morningTable');
const nightDiv = document.getElementById('nightTable');
const lastUpdated = document.getElementById('lastUpdated');
const passwordPrompt = document.getElementById('passwordPrompt');
const passwordInput = document.getElementById('passwordInput');

let allData = [], headers = [], currentMonth = "ALL";

// Password protection check
function checkPassword() {
  const enteredPassword = passwordInput.value.trim();
  if (enteredPassword === validPassword) {
    passwordPrompt.style.display = 'none';
    loadData();
  } else {
    alert("Invalid password");
  }
}

// Toggle password visibility
function togglePassword() {
  const passwordField = document.getElementById('passwordInput');
  if (passwordField.type === "password") {
    passwordField.type = "text";
  } else {
    passwordField.type = "password";
  }
}

async function loadData() {
  const response = await fetch(CSV_URL);
  const text = await response.text();
  processCSV(text);
  lastUpdated.textContent = "Last updated: " + new Date().toLocaleString();
}

function processCSV(text) {
  const lines = text.trim().split('\n').map(parseCSVLine);
  headers = lines[0].map(h => h ? h.trim() : "");
  allData = lines.slice(1);
  populateMonths();
  displayData(currentMonth);
}

function parseCSVLine(line) {
  const result = [];
  let inQuotes = false, value = '';
  for (let i = 0; i < line.length; i++) {
    const c = line[i];
    if (c == '"' && line[i + 1] == '"') { value += c; i++; }
    else if (c == '"') inQuotes = !inQuotes;
    else if (c == ',' && !inQuotes) { result.push(value.trim()); value = ''; }
    else value += c;
  }
  result.push(value.trim());
  return result;
}

function populateMonths() {
  const months = [...new Set(allData.map(row => row[0]))];
  const monthDropdownOptions = months.map(month => ({
    value: month,
    text: formatMonth(month)
  }));

  monthDropdownOptions.sort((a, b) => new Date(b.value) - new Date(a.value));

  // Set the default selected month as the latest month
  monthDropdown.innerHTML = monthDropdownOptions.map(opt => 
    `<option value="${opt.value}" ${opt.value === monthDropdownOptions[0].value ? 'selected' : ''}>${opt.text}</option>`
  ).join('');

  monthDropdown.value = monthDropdownOptions[0].value;
  currentMonth = monthDropdown.value;
}

function formatMonth(month) {
  const date = new Date(month);
  const options = { month: 'short', year: '2-digit' };
  return new Intl.DateTimeFormat('en-US', options).format(date);
}

function displayData(month) {
  const filteredData = allData.filter(row => row[0] === month);
  processTopMetrics(filteredData);
  populateShiftTables(filteredData);
}

function processTopMetrics(data) {
  const topSokData = data.sort((a, b) => b[1] - a[1])[0];
  const topProfitData = data.sort((a, b) => b[2] - a[2])[0];
  const topCallsData = data.sort((a, b) => b[3] - a[3])[0];

  topSok.innerHTML = `<div class="title">Top SOK</div><div class="agent">${topSokData[4]}</div><div class="value">${topSokData[1]}</div>`;
  topProfit.innerHTML = `<div class="title">Top Profit</div><div class="agent">${topProfitData[4]}</div><div class="value">${topProfitData[2]}</div>`;
  topCalls.innerHTML = `<div class="title">Top Calls</div><div class="agent">${topCallsData[4]}</div><div class="value">${topCallsData[3]}</div>`;
}

function populateShiftTables(data) {
  const morningShiftData = data.filter(row => row[5] === "Morning");
  const nightShiftData = data.filter(row => row[5] === "Night");

  morningDiv.innerHTML = generateTableHTML(morningShiftData);
  nightDiv.innerHTML = generateTableHTML(nightShiftData);
}

function generateTableHTML(data) {
  const headers = ["Agent", "SOK", "Profit", "Calls"];
  const rows = data.map(row => `
    <tr>
      <td>${row[4]}</td>
      <td>${row[1]}</td>
      <td>${row[2]}</td>
      <td>${row[3]}</td>
    </tr>
  `).join('');

  return `
    <table>
      <thead>
        <tr>
          ${headers.map(header => `<th>${header}</th>`).join('')}
        </tr>
      </thead>
      <tbody>
        ${rows}
      </tbody>
    </table>
  `;
}

</script>
</body>
</html>
