<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Agent Dashboard</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: #e0f7ff;
    color: #003366;
    margin: 0;
    user-select: none;
    font-size: 11px;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  h2 { text-align: center; color: #0077cc; margin: 5px 0; font-size: 18px; }
  #lastUpdated { text-align: center; font-size: 10px; color: #004d80; margin: 2px 0; }
  select {
    padding: 3px 6px; font-size: 11px; border-radius: 4px; border: 1px solid #00bfff;
    background: #b3e5ff; color: #003366; margin-bottom: 6px;
  }
  .top-row { display: flex; justify-content: center; gap: 8px; margin-bottom: 12px; }
  .metric-box {
    flex: 0 0 32%; background: linear-gradient(135deg, #00bfff, #1ec5ff);
    border: 2px solid #00f0ff; padding: 12px; border-radius: 12px;
    text-align: center; font-weight: bold; color: #003366;
    box-shadow: 0 0 15px rgba(0, 240, 255, 0.9);
  }
  /* Animate only text */
  .metric-box .title, .metric-box .agent { animation: textPop 2s infinite alternate; }
  @keyframes textPop { 0%{transform:scale(1);} 50%{transform:scale(1.1);} 100%{transform:scale(1);} }
  .metric-box .title {
    font-size: 16px; font-weight: bold; text-shadow: 0 0 3px #00f0ff, 0 0 6px #00f0ff; margin-bottom: 6px;
  }
  .metric-box .agent { font-size: 14px; margin: 3px 0; text-shadow: 0 0 2px #ffffff, 0 0 4px #00bfff; }
  .shift-container { display: flex; justify-content: space-between; gap: 6px; flex: 1 1 auto; overflow: hidden; }
  .shift-table {
    background: #b3e5ff; border-radius: 6px; padding: 6px; flex: 1; min-width: 45%;
    box-shadow: 0 0 8px #00bfff88; text-align: center; display: flex; flex-direction: column; height: 100%;
    color: #003366; overflow: hidden;
  }
  .shift-table h3 { margin: 3px 0 6px; font-size: 13px; color: #0077cc; }
  table { width: 100%; border-collapse: collapse; font-size: 11px; background: #e6f7ff; flex: 1 1 auto; color: #003366; }
  thead th { background: #00bfff; padding: 4px; font-size: 11px; color: #003366; cursor: pointer; border-radius: 4px; }
  tbody td { padding: 3px 2px; text-align: center; border-bottom: 1px solid #00aaff; }
  tbody tr:nth-child(odd) { background-color: #cceeff; }
  tbody tr:last-child { background-color: #00bfff; font-weight: bold; color: #ffffff; }
  tbody tr:hover { background-color: #99e6ff; }
  /* Password Screen */
  #passwordScreen {
    display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #e0f7ff;
  }
  #passwordScreen input { padding: 5px; margin: 5px; border-radius: 4px; border: 1px solid #00bfff; }
  #passwordScreen button { padding: 5px 10px; border: none; background: #00bfff; color: #003366; font-weight: bold; cursor: pointer; border-radius: 4px; }
  #errorMsg { color: red; font-size: 12px; margin-top: 5px; }
</style>
</head>
<body>
<div id="passwordScreen">
  <h2>Enter Password</h2>
  <input type="password" id="passwordInput" placeholder="Password">
  <label><input type="checkbox" id="showPass"> Show Password</label>
  <button id="passwordBtn">Submit</button>
  <div id="errorMsg"></div>
</div>

<div id="dashboard" style="display:none;">
<h2>Agent Dashboard</h2>
<div id="lastUpdated"></div>
<div style="text-align:center;">
  <select id="monthDropdown"></select>
  <select id="quarterDropdown"></select>
</div>
<div class="top-row">
  <div id="topSok" class="metric-box"></div>
  <div id="topProfit" class="metric-box"></div>
  <div id="topCalls" class="metric-box"></div>
</div>
<div class="shift-container">
  <div class="shift-table">
    <h3>Morning Shift</h3>
    <div id="morningTable" style="flex:1 1 auto; overflow:auto;"></div>
  </div>
  <div class="shift-table">
    <h3>Night Shift</h3>
    <div id="nightTable" style="flex:1 1 auto; overflow:auto;"></div>
  </div>
</div>
</div>

<script>
const CSV_URL = "YOUR_CSV_URL";
const PASSWORD = "blauda123";

let allData = [], headers = [], currentMonth = "", currentQuarter = "";

document.getElementById('showPass').addEventListener('change', e => {
  document.getElementById('passwordInput').type = e.target.checked ? 'text' : 'password';
});
document.getElementById('passwordBtn').addEventListener('click', checkPassword);
document.getElementById('passwordInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') checkPassword();
});

function checkPassword() {
  const inputPass = document.getElementById('passwordInput').value;
  if (inputPass === PASSWORD) {
    document.getElementById('passwordScreen').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';
    loadData();
  } else {
    document.getElementById('errorMsg').textContent = 'Incorrect password!';
  }
}

async function loadData() {
  const response = await fetch(CSV_URL);
  const text = await response.text();
  processCSV(text);
  document.getElementById('lastUpdated').textContent = "Last updated: " + new Date().toLocaleString();
}

function parseCSVLine(line) {
  const result = [];
  let inQuotes = false, value = '';
  for (let i = 0; i < line.length; i++) {
    const c = line[i];
    if (c == '"' && line[i+1] == '"') { value += '"'; i++; }
    else if (c == '"') inQuotes = !inQuotes;
    else if (c == ',' && !inQuotes) { result.push(value.trim()); value = ''; }
    else value += c;
  }
  result.push(value.trim());
  return result;
}

function excelDateToJSDate(serial) {
  if (!isNaN(serial) && serial > 25569) {
    const utc_days = Math.floor(serial - 25569);
    const utc_value = utc_days * 86400;                                        
    return new Date(utc_value * 1000);
  }
  return new Date(serial);
}

function processCSV(text) {
  const lines = text.trim().split('\n').map(parseCSVLine);
  headers = lines[0];
  allData = lines.slice(1);
  populateFilters();
  addFilterListeners();
  displayData();
}

function populateFilters() {
  const monthIndex = headers.indexOf("Month");
  const quarterIndex = headers.indexOf("Quarters");

  const monthSet = new Set();
  const quarterSet = new Set();

  allData.forEach(row => {
    monthSet.add(row[monthIndex]);
    quarterSet.add(row[quarterIndex]);
  });

  const monthArray = Array.from(monthSet)
    .map(m => ({ raw: m, date: excelDateToJSDate(m) }))
    .filter(m => !isNaN(m.date))
    .sort((a,b) => b.date - a.date);

  const quarterArray = Array.from(quarterSet);

  document.getElementById('monthDropdown').innerHTML =
    `<option value="">All Months</option>` +
    monthArray.map(m => `<option value="${m.raw}">${m.date.toLocaleString('en-US',{month:'short',year:'2-digit'})}</option>`).join('');

  document.getElementById('quarterDropdown').innerHTML =
    `<option value="">All Quarters</option>` +
    quarterArray.map(q => `<option value="${q}">${q}</option>`).join('');

  if (monthArray.length > 0) {
    document.getElementById('monthDropdown').value = monthArray[0].raw;
    currentMonth = monthArray[0].raw;
  }
}

function addFilterListeners() {
  document.getElementById('monthDropdown').addEventListener('change', e => {
    currentMonth = e.target.value;
    if (currentMonth) {
      document.getElementById('quarterDropdown').value = "";
      currentQuarter = "";
    }
    displayData();
  });
  document.getElementById('quarterDropdown').addEventListener('change', e => {
    currentQuarter = e.target.value;
    if (currentQuarter) {
      document.getElementById('monthDropdown').value = "";
      currentMonth = "";
    }
    displayData();
  });
}

function displayData() {
  // Your original table + topper logic goes here
}
</script>
</body>
</html>
