<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Agent Dashboard</title>
<style>
  body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #0d1f2d; color: white; margin: 0; user-select: none; font-size: 11px; display: flex; flex-direction: column; height: 100vh; }
  h2 { text-align: center; color: #62b6f3; margin: 5px 0; font-size: 18px; }
  #lastUpdated { text-align: center; font-size: 10px; color: #cccccc; margin: 2px 0; }
  select { padding: 3px 6px; font-size: 11px; border-radius: 4px; border: 1px solid #62b6f3; background: #1f2e44; color: white; margin-bottom: 4px; }
  .top-row { display: flex; justify-content: center; gap: 10px; margin-bottom: 8px; }
  .metric-box { flex: 0 0 33%; background: linear-gradient(135deg, #4e9eff, #62b6f3); border: 2px solid #3a8dff; padding: 10px; border-radius: 10px; text-align: center; font-weight: bold; color: white; box-shadow: 0 0 15px rgba(68, 124, 190, 0.7); animation: glow 2s infinite alternate; }
  .metric-box .title { font-size: 18px; font-weight: bold; text-shadow: 0 0 5px #3a8dff, 0 0 10px #3a8dff; margin-bottom: 5px; }
  .metric-box .agent { font-size: 16px; margin: 3px 0; text-shadow: 0 0 5px #ffffff, 0 0 10px #62b6f3; }
  @keyframes glow { from { box-shadow: 0 0 10px rgba(68, 124, 190, 0.6), 0 0 20px rgba(68, 124, 190, 0.6); } to { box-shadow: 0 0 20px rgba(68, 124, 190, 1), 0 0 40px rgba(68, 124, 190, 1); } }
  .shift-container { display: flex; justify-content: space-between; gap: 6px; flex: 1 1 auto; overflow: hidden; }
  .shift-table { background: #1e2a3b; border-radius: 6px; padding: 4px; flex: 1; min-width: 45%; box-shadow: 0 0 6px #62b6f388; text-align: center; display: flex; flex-direction: column; height: 100%; }
  .shift-table h3 { margin: 3px 0 4px; font-size: 13px; color: #62b6f3; }
  table { width: 100%; border-collapse: collapse; font-size: 11px; background: #243244; flex: 1 1 auto; }
  thead th { background: #3a5a7b; padding: 3px; font-size: 11px; color: white; cursor: pointer; }
  tbody td { padding: 3px 2px; text-align: center; border-bottom: 1px solid #2d4552; }
  tbody tr:nth-child(odd) { background-color: #2e3d54; }
  tbody tr:last-child { background-color: #3a5a7b; font-weight: bold; }
</style>
</head>
<body>
  <h2>Agent Dashboard - Compact View</h2>
  <div id="lastUpdated"></div>
  <div style="text-align:center;">
    <div id="monthSelection">
      <label><input type="checkbox" id="selectAllMonths"> All Months</label>
      <br>
      <div id="monthCheckboxes"></div>
    </div>
    <select id="quarterDropdown">
      <option value="ALL">All Quarters</option>
      <option value="Q1">Q1 (Oct, Nov, Dec)</option>
      <option value="Q2">Q2 (Jan, Feb, Mar)</option>
      <option value="Q3">Q3 (Apr, May, Jun)</option>
      <option value="Q4">Q4 (Jul, Aug, Sep)</option>
    </select>
  </div>

  <div class="top-row">
    <div id="topSok" class="metric-box"></div>
    <div id="topProfit" class="metric-box"></div>
    <div id="topCalls" class="metric-box"></div>
  </div>

  <div class="shift-container">
    <div class="shift-table">
      <h3>Morning Shift</h3>
      <div id="morningTable" style="flex: 1 1 auto; overflow: auto;"></div>
    </div>
    <div class="shift-table">
      <h3>Night Shift</h3>
      <div id="nightTable" style="flex: 1 1 auto; overflow: auto;"></div>
    </div>
  </div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRyYD7X2tEKE1YJZU8pEF1KNtW43dMh0Kg-kRr1NV7u5mJZnSBZq_7p6OBCb3X322z10ReriXHngSRq/pub?gid=1105455398&single=true&output=csv";

const monthSelection = document.getElementById('monthSelection');
const monthCheckboxes = document.getElementById('monthCheckboxes');
const quarterDropdown = document.getElementById('quarterDropdown');
const topSok = document.getElementById('topSok');
const topProfit = document.getElementById('topProfit');
const topCalls = document.getElementById('topCalls');
const morningDiv = document.getElementById('morningTable');
const nightDiv = document.getElementById('nightTable');
const lastUpdated = document.getElementById('lastUpdated');
const selectAllMonthsCheckbox = document.getElementById('selectAllMonths');

let allData = [], headers = [], currentMonths = [], currentQuarter = "ALL";

async function loadData() {
  const response = await fetch(CSV_URL);
  const text = await response.text();
  processCSV(text);
  lastUpdated.textContent = "Last updated: " + new Date().toLocaleString();
}

function processCSV(text) {
  const lines = text.trim().split('\n').map(parseCSVLine);
  headers = lines[0].map(h => h ? h.trim() : "");
  allData = lines.slice(1);
  populateMonths();
  displayData(currentMonths, currentQuarter);
}

function parseCSVLine(line) {
  const result = [];
  let inQuotes = false, value = '';
  for (let i = 0; i < line.length; i++) {
    const c = line[i];
    if (c === '"' && line[i+1] === '"') { value += '"'; i++; }
    else if (c === '"') inQuotes = !inQuotes;
    else if (c === ',' && !inQuotes) { result.push(value.trim()); value = ''; }
    else value += c;
  }
  result.push(value.trim());
  return result;
}

function populateMonths() {
  const monthIndex = headers.indexOf("Month");
  const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
  const monthPairs = Array.from(new Set(allData.map(row => {
    const raw = row[monthIndex];
    if (!raw) return null;
    let dateObj;
    if (!isNaN(Date.parse(raw))) {
      dateObj = new Date(raw);
    } else {
      const parts = raw.split(/[-\\/]/);
      if (parts.length >= 3) {
        const day = parseInt(parts[0], 10);
        const monthIdx = isNaN(parts[1]) ? monthNames.findIndex(n => n.toLowerCase() === parts[1].slice(0,3).toLowerCase()) : parseInt(parts[1], 10) - 1;
        const year = parseInt(parts[2], 10);
        dateObj = new Date(year, monthIdx, day);
      }
    }
    if (dateObj && !isNaN(dateObj)) {
      const formatted = monthNames[dateObj.getMonth()] + '-' + dateObj.getFullYear().toString().slice(2);
      return JSON.stringify({ raw: raw, formatted: formatted });
    }
    return null;
  }).filter(Boolean)));

  const uniquePairs = monthPairs.map(str => JSON.parse(str));
  monthCheckboxes.innerHTML = uniquePairs.map(p => `
    <label>
      <input type="checkbox" class="monthCheckbox" value="${p.raw}"> ${p.formatted}
    </label><br>
  `).join('');

  // All months selection checkbox
  selectAllMonthsCheckbox.addEventListener("change", function() {
    const checkboxes = document.querySelectorAll('.monthCheckbox');
    checkboxes.forEach(checkbox => checkbox.checked = selectAllMonthsCheckbox.checked);
    currentMonths = selectAllMonthsCheckbox.checked ? uniquePairs.map(p => p.raw) : [];
    displayData(currentMonths, currentQuarter);
  });

  const checkboxes = document.querySelectorAll('.monthCheckbox');
  checkboxes.forEach(checkbox => checkbox.addEventListener('change', function() {
    currentMonths = Array.from(checkboxes).filter(c => c.checked).map(c => c.value);
    displayData(currentMonths, currentQuarter);
  }));
}

function displayData(months, quarter) {
  // Filter data by selected months and quarter
  let filteredData = allData.filter(row => {
    const month = row[headers.indexOf('Month')];
    const matchesMonth = months.length === 0 || months.includes(month);
    const matchesQuarter = quarter === "ALL" || (quarter === "Q1" && ["Oct", "Nov", "Dec"].includes(month)) ||
      (quarter === "Q2" && ["Jan", "Feb", "Mar"].includes(month)) ||
      (quarter === "Q3" && ["Apr", "May", "Jun"].includes(month)) ||
      (quarter === "Q4" && ["Jul", "Aug", "Sep"].includes(month));
    return matchesMonth && matchesQuarter;
  });

  // Display filtered data in the tables
  updateTable(filteredData, 'Morning');
  updateTable(filteredData, 'Night');
}

function updateTable(filteredData, shift) {
  const tableDiv = shift === 'Morning' ? morningDiv : nightDiv;
  const shiftData = filteredData.filter(row => row[headers.indexOf('Shift')] === shift);
  let tableHTML = `
    <table>
      <thead>
        <tr>
          <th>Agent</th>
          <th>Task</th>
          <th>Time</th>
        </tr>
      </thead>
      <tbody>
        ${shiftData.map(row => `
          <tr>
            <td>${row[headers.indexOf('Agent')]}</td>
            <td>${row[headers.indexOf('Task')]}</td>
            <td>${row[headers.indexOf('Time')]}</td>
          </tr>`).join('')}
      </tbody>
    </table>
  `;
  tableDiv.innerHTML = tableHTML;
}

loadData();
</script>
</body>
</html>
