<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Agent Dashboard</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: #e0f7ff;
    color: #003366;
    margin: 0;
    user-select: none;
    font-size: 11px;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  h2 {
    text-align: center;
    color: #0077cc;
    margin: 5px 0;
    font-size: 18px;
  }

  #lastUpdated {
    text-align: center;
    font-size: 10px;
    color: #004d80;
    margin: 2px 0;
  }

  select {
    padding: 3px 6px;
    font-size: 11px;
    border-radius: 4px;
    border: 1px solid #00bfff;
    background: #b3e5ff;
    color: #003366;
    margin-bottom: 6px;
  }

  .top-row {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 12px;
  }

  .metric-box {
    flex: 0 0 32%;
    background: linear-gradient(135deg, #00bfff, #1ec5ff);
    border: 2px solid #00f0ff;
    padding: 12px;
    border-radius: 12px;
    text-align: center;
    font-weight: bold;
    color: #003366;
    box-shadow: 0 0 15px rgba(0, 240, 255, 0.9);
    position: relative;
    overflow: hidden;
    animation: pop 2s infinite alternate;
  }

  .metric-box:nth-child(2) {
    animation-delay: 0.3s;
  }

  .metric-box:nth-child(3) {
    animation-delay: 0.6s;
  }

  @keyframes pop {
    0% { transform: scale(1); box-shadow: 0 0 15px rgba(0, 240, 255, 0.7); }
    50% { transform: scale(1.1); box-shadow: 0 0 25px rgba(0, 240, 255, 1); }
    100% { transform: scale(1); box-shadow: 0 0 15px rgba(0, 240, 255, 0.7); }
  }

  .metric-box .title {
    font-size: 16px;
    font-weight: bold;
    text-shadow: 0 0 3px #00f0ff, 0 0 6px #00f0ff;
    margin-bottom: 6px;
    letter-spacing: 0.5px;
  }

  .metric-box .agent {
    font-size: 14px;
    margin: 3px 0;
    text-shadow: 0 0 2px #ffffff, 0 0 4px #00bfff;
  }

  .shift-container {
    display: flex;
    justify-content: space-between;
    gap: 6px;
    flex: 1 1 auto;
    overflow: hidden;
  }

  .shift-table {
    background: #b3e5ff;
    border-radius: 6px;
    padding: 6px;
    flex: 1;
    min-width: 45%;
    box-shadow: 0 0 8px #00bfff88;
    text-align: center;
    display: flex;
    flex-direction: column;
    height: 100%;
    color: #003366;
    overflow: hidden;
  }

  .shift-table h3 {
    margin: 3px 0 6px;
    font-size: 13px;
    color: #0077cc;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 11px;
    background: #e6f7ff;
    flex: 1 1 auto;
    color: #003366;
    overflow: hidden;
  }

  thead th {
    background: #00bfff;
    padding: 4px;
    font-size: 11px;
    color: #003366;
    cursor: pointer;
    border-radius: 4px;
  }

  tbody td {
    padding: 3px 2px;
    text-align: center;
    border-bottom: 1px solid #00aaff;
  }

  tbody tr:nth-child(odd) {
    background-color: #cceeff;
  }

  tbody tr:last-child {
    background-color: #00bfff;
    font-weight: bold;
    color: #ffffff;
  }

  tbody tr:hover {
    background-color: #99e6ff;
  }

  /* Add color to the password input field */
  input[type="password"], input[type="text"] {
    color: black;
  }
</style>
</head>
<body>

<!-- Password Protection Popup -->
<div id="passwordPopup" style="display: none;">
  <div style="text-align: center; background-color: #ffffff; padding: 20px; border: 2px solid #0077cc; border-radius: 12px; width: 300px; margin: 100px auto;">
    <h3>Enter Password</h3>
    <input type="password" id="password" placeholder="Password" style="padding: 8px; width: 80%; margin-bottom: 10px;">
    <input type="checkbox" id="showPassword"> Show Password
    <br>
    <button onclick="validatePassword()" style="padding: 8px 15px; background-color: #0077cc; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">Submit</button>
  </div>
</div>

<h2>Agent Dashboard - Compact View</h2>
<div id="lastUpdated"></div>
<div style="text-align:center;">
  <select id="monthDropdown"></select>
</div>

<div class="top-row">
  <div id="topSok" class="metric-box"></div>
  <div id="topProfit" class="metric-box"></div>
  <div id="topCalls" class="metric-box"></div>
</div>

<div class="shift-container">
  <div class="shift-table">
    <h3>Morning Shift</h3>
    <div id="morningTable" style="flex:1 1 auto; overflow:auto;"></div>
  </div>
  <div class="shift-table">
    <h3>Night Shift</h3>
    <div id="nightTable" style="flex:1 1 auto; overflow:auto;"></div>
  </div>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRyYD7X2tEKE1YJZU8pEF1KNtW43dMh0Kg-kRr1NV7u5mJZnSBZq_7p6OBCb3X322z10ReriXHngSRq/pub?gid=1105455398&single=true&output=csv";

const monthDropdown = document.getElementById('monthDropdown');
const topSok = document.getElementById('topSok');
const topProfit = document.getElementById('topProfit');
const topCalls = document.getElementById('topCalls');
const morningDiv = document.getElementById('morningTable');
const nightDiv = document.getElementById('nightTable');
const lastUpdated = document.getElementById('lastUpdated');

let allData = [], headers = [], currentMonth = "ALL";
const validPassword = "blauda123";  // Replace with your actual password

// Show the password popup on page load
showPasswordPopup();

function showPasswordPopup() {
  document.getElementById('passwordPopup').style.display = 'block';
}

function validatePassword() {
  const enteredPassword = document.getElementById('password').value;
  if (enteredPassword === validPassword) {
    document.getElementById('passwordPopup').style.display = 'none';
    loadData();
  } else {
    alert('Incorrect password');
  }
}

document.getElementById('showPassword').addEventListener('change', function() {
  const passwordField = document.getElementById('password');
  passwordField.type = this.checked ? 'text' : 'password';
});

async function loadData() {
  const response = await fetch(CSV_URL);
  const text = await response.text();
  processCSV(text);
  lastUpdated.textContent = "Last updated: " + new Date().toLocaleString();
}

function processCSV(text) {
  const lines = text.trim().split('\n').map(parseCSVLine);
  headers = lines[0].map(h => h.trim());
  allData = lines.slice(1);

  populateMonths();
  displayData(currentMonth);
}

function parseCSVLine(line) {
  const result = [];
  let inQuotes = false, value = '';
  for (let i = 0; i < line.length; i++) {
    const char = line[i];
    if (char === '"' && line[i - 1] !== '\\') {
      inQuotes = !inQuotes;
    } else if (char === ',' && !inQuotes) {
      result.push(value.trim());
      value = '';
    } else {
      value += char;
    }
  }
  result.push(value.trim());
  return result;
}

function populateMonths() {
  const monthIndex = headers.indexOf('Month');
  const monthSet = new Set(allData.map(row => row[monthIndex] || ""));
  const months = Array.from(monthSet);

  months.forEach(month => {
    const option = document.createElement('option');
    option.value = month;
    option.textContent = month;
    monthDropdown.appendChild(option);
  });

  // Default to latest month ("Aug-25" as the latest in data)
  if (months.length > 0) {
    monthDropdown.value = "Aug-25";  // Set default month
    currentMonth = "Aug-25";  // Set default month
  }
}

function displayData(month) {
  const monthIndex = headers.indexOf('Month');
  const filteredData = month === "ALL" ? allData : allData.filter(row => row[monthIndex] === month);

  const morningData = filteredData.filter(row => row[headers.indexOf('Shift')] === 'Morning');
  const nightData = filteredData.filter(row => row[headers.indexOf('Shift')] === 'Night');

  renderTable(morningDiv, morningData);
  renderTable(nightDiv, nightData);

  updateMetrics(filteredData);
}

function renderTable(container, data) {
  const table = document.createElement('table');
  const headerRow = document.createElement('tr');
  
  headers.forEach(header => {
    const th = document.createElement('th');
    th.textContent = header;
    headerRow.appendChild(th);
  });

  table.appendChild(headerRow);

  data.forEach(row => {
    const rowElement = document.createElement('tr');
    row.forEach(cell => {
      const td = document.createElement('td');
      td.textContent = cell;
      rowElement.appendChild(td);
    });
    table.appendChild(rowElement);
  });

  container.innerHTML = '';  // Clear any existing content
  container.appendChild(table);
}

function updateMetrics(data) {
  const sok = data.filter(row => row[headers.indexOf('SOK')] !== "").length;
  const profit = data.reduce((total, row) => total + parseFloat(row[headers.indexOf('Profit')] || 0), 0);
  const calls = data.reduce((total, row) => total + parseInt(row[headers.indexOf('Calls')] || 0), 0);

  topSok.innerHTML = `<div class="title">SOK</div><div class="agent">${sok}</div>`;
  topProfit.innerHTML = `<div class="title">Profit</div><div class="agent">${profit}</div>`;
  topCalls.innerHTML = `<div class="title">Calls</div><div class="agent">${calls}</div>`;
}

</script>
</body>
</html>
